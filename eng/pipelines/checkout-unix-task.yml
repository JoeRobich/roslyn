# Shallow checkout sources on Unix
steps:
  - checkout: none

  # This script needs to be reevaluated. The Build.SourceVersion is the last
  # commit SHA to the pull request and  does not include the merge commit.
  # The equivalent of building `refs/pull/###/head` instead of `refs/pull/###/merge`.
  # See https://github.com/dotnet/roslyn/issues/52444
  - script: |
      set -x
      git init
      git remote add origin "$(Build.Repository.Uri)"
      git fetch --progress --no-tags --depth=1 origin "$(Build.SourceVersion)"
      git checkout "$(Build.SourceVersion)"
    displayName: Shallow Checkout
